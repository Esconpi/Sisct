$(document).ready(function () { function e() { $.ajax({ type: "GET", url: "/Launch/ProtocolsById/" + $("#txtNumeroLote").val(), dataType: "html", cache: !1, async: !0, success: function (e) { $(".loader").css("display", "none"), $("#divLot").html(e), $("#tblAllProtocols").DataTable({ pageLength: 3, bLengthChange: !1 }) } }) } $("#tblAllProtocol").DataTable({ pageLength: 3, bLengthChange: !1, bFilter: !1 }), $("span").css("font-style", "italic"), $("#txtValue").focus(), $("#btnAddExpense").attr("disabled", "disabled"), $("#btnSaveProtocol").attr("disabled", "disabled"), $(".loader").css("display", "none"), setTimeout(function () { e() }, 500); var t = parseFloat("0"), o = parseFloat("0"), a = parseFloat("0"), l = parseFloat("0"), s = parseFloat("0"), n = parseFloat("0"), r = "", c = !1; function i() { var e = new FileReader, t = document.getElementById("documentFile").files[0]; e.readAsDataURL(t), e.onload = function () { r = e.result }, e.onerror = function (e) { console.log("Error: ", e) } } function d(e) { $("#formShow .modal-body").html(e), $("#formShow").modal("show") } function u(e) { $("#formShowAlert .modal-body").html(e), $("#formShowAlert").modal("show") } function p() { $("#txtValue").focus(), $("#tblAllExpensers tbody tr").each(function () { $(this).remove() }), $("#spanTotalExpense").text("0,00"), $("#btnSaveProtocol").attr("disabled", "disabled"), $("#PayingSource").closest("td").css("border", "none"), $("#PayingSource").val("0").change(), $("#tblSource tbody tr").each(function () { $(this).remove() }), $("#tblSource tbody tr").each(function () { $(this).remove() }), $("#tblAllExpensers tbody tr").each(function () { $(this).remove() }), $("#vlrTotal").text("R$ 0,00"), $("#vlrTotal").closest("td").css("border", "none"), x() } function x() { r = "", $("#spanNameDocument").text(""), $("#Companies").closest("td").css("border", "none"), $("#Expense").closest("td").css("border", "none"), $("#DocumentType").closest("td").css("border", "none"), $("#Historic").closest("td").css("border", "none"), $("#txtComplement").closest("td").css("border", "none"), $("#txtComplementDescription").closest("td").css("border", "none"), $("#txtComplement").val(""), $("#Companies").val("0").change(), $("#Expense").val("0").change(), $("#DocumentType").val("0").change(), $("#Historic").val("0").change(), $("#Historic").prop("selectedIndex", 0).change(), $("#txtComplementDescription").val("").change(), $("#txtNumDocument").val(""), $("#txtValueExpense").val(""), $("#txtNumDocument").closest("td").css("border", "none"), $("#txtPartialValue").val("0,00"), $("#txtPartialValue").closest("td").css("border", "none"), $("#txtValueJuros").val("0,00"), $("#txtValueJuros").closest("td").css("border", "none"), $("#txtValueMulta").val("0,00"), $("#txtValueMulta").closest("td").css("border", "none"), $("#txtValueDescontos").val("0,00"), $("#txtValueDescontos").closest("td").css("border", "none"), $("#txtValueTaxas").val("0,00"), $("#txtValueTaxas").closest("td").css("border", "none"), $("#txtValueCartorio").val("0,00"), $("#txtValueCartorio").closest("td").css("border", "none"), $("#txtTotalValue").val("0,00"), $("#txtTotalValue").closest("td").css("border", "none") } function f() { var e = t + o + a - l + s + n; $("#txtTotalValue").val(e), e != parseFloat($("#txtValueExpense").val().replace("R$", "").replace(",", ".")) ? ($("#txtTotalValue").closest("td").css("border", "1px solid red"), $("#btnAddExpense").attr("disabled", "disabled")) : ($("#txtTotalValue").closest("td").css("border", "1px solid green"), $("#btnAddExpense").removeAttr("disabled", "disabled")) } function m() { var e = parseFloat($("#vlrTotal").text().replace("R$", "").replace(",", ".")).toFixed(2), t = parseFloat($("#spanTotalExpense").text().replace("R$", "").replace(",", ".")).toFixed(2); 0 == t | 0 == e && ($("#btnSaveProtocol").removeAttr("disabled", "disabled"), $("#spanMessageProtocol").css("display", "none")), e == t ? ($("#btnSaveProtocol").removeAttr("disabled", "disabled"), $("#spanMessageProtocol").css("display", "none")) : ($("#btnSaveProtocol").attr("disabled", "disabled"), $("#spanMessageProtocol").css("display", "block")) } function v(e) { return isNaN(e) ? e : "R$ " + parseFloat(e).toFixed(2).replace(".", ",") } $("#Expense").on("change", function () { var e = $('#ExpenseAccount option[value="' + $(this).val() + '"]').text(); $("#txtComplementDescription").val("").change(), "3" === e[0] ? ($("#txtComplementDescription").removeAttr("disabled"), c = !0) : ($("#txtComplementDescription").attr("disabled", "disabled"), c = !1), $(this).select2("close") }), $("#btnAddExpense").click(function () { if ("0" == $("#Companies option:selected").val()) return u("Selecione o estabelecimento"), $("#Companies").focus(), $("#Companies").select2("open"), void $("#Companies").closest("td").css("border", "1px solid red"); if ("0" == $("#Expense option:selected").val()) return u("Selecione uma despesa"), $("#Expense").focus(), $("#Expense").select2("open"), void $("#Expense").closest("td").css("border", "1px solid red"); if ("" == $("#txtValueExpense").val()) return u("Informe o valor da despesa"), $("#txtValueExpense").focus(), void $("#txtValueExpense").closest("td").css("border", "1px solid red"); if (0 == $("#vlrTotal").text().replace("R$", "")) return u("Nenhuma despesa foi informada."), void $("#Expense").closest("td").css("border", "1px solid red"); if ("0" == $("#DocumentType option:selected").val()) return u("Selecione o tipo do documento"), $("#DocumentType").focus(), void $("#DocumentType").closest("td").css("border", "1px solid red"); if ("0" == $("#Historic option:selected").val()) return u("Selecione o histórico"), $("#Historic").focus(), void $("#Historic").closest("td").css("border", "1px solid red"); if ("" == $("#txtDtDocument").val()) return u("Informe a data do documento"), $("#txtDtDocument").focus(), void $("#txtDtDocument").closest("td").css("border", "1px solid red"); if ("" == $("#txtNumDocument").val()) return u("Informe o número do documento"), $("#txtNumDocument").focus(), void $("#txtNumDocument").closest("td").css("border", "1px solid red"); if ("" == $("#txtPartialValue").val()) return u("Informe o valor parcial pago"), $("#txtPartialValue").focus(), void $("#txtPartialValue").closest("td").css("border", "1px solid red"); if ("" == $("#txtValueJuros").val()) return u("Informe o valor dos Interest"), $("#txtValueJuros").focus(), void $("#txtValueJuros").closest("td").css("border", "1px solid red"); if ("" == $("#txtValueMulta").val()) return u("Informe o valor da multa"), $("#txtValueMulta").focus(), void $("#txtValueMulta").closest("td").css("border", "1px solid red"); if ("" == $("#txtValueDescontos").val()) return u("Informe o valor dos descontos"), $("#txtValueDescontos").focus(), void $("#txtValueDescontos").closest("td").css("border", "1px solid red"); if ("" == $("#txtValueTaxas").val()) return u("Informe o valor das Rate"), $("#txtValueTaxas").focus(), void $("#txtValueTaxas").closest("td").css("border", "1px solid red"); if ("" == $("#txtValueCartorio").val()) return u("Informe o valor de cartório"), $("#txtValueCartorio").focus(), void $("#txtValueCartorio").closest("td").css("border", "1px solid red"); if (c) { if ($("#txtComplementDescription").val().length <= 0) return u("Você deve informar um complemento para o histórico"), $("#txtComplementDescription").closest("td").css("border", "1px solid red"), void $("#txtComplementDescription").focus(); $("#txtComplementDescription").closest("td").css("border", "none") } if (parseFloat($("#txtValueExpense").val().replace(",", ".")) != parseFloat($("#txtTotalValue").val().replace(",", "."))) return void u("O valor do documento está diferente do valor informado no lançamento."); const e = r; var t = "<tr>"; t = (t = (t = (t = (t = (t = (t = (t = (t = (t = (t = (t = t + "<td class='company'><input type='hidden' value='" + $("#Companies option:selected").val() + "' />" + $("#Companies option:selected").val() + "</td>") + "<td class='expense'><input type='hidden' value='" + $("#Expense option:selected").val() + "' />" + $("#Expense option:selected").text() + "</td>") + "<td class='documenttype'><input type='hidden' value='" + $("#DocumentType option:selected").val() + "' />" + $("#DocumentType option:selected").text() + "</td>") + "<td class='documentdate'>" + $("#txtDtDocument").val() + "</td>") + "<td class='documentnumber'>" + $("#txtNumDocument").val() + "</td>") + "<td class='documentvalue'>R$ " + parseFloat($("#txtPartialValue").val().replace(",", ".")).toFixed(2).replace(".", ",") + "</td>") + "<td class='interest'>R$ " + parseFloat($("#txtValueJuros").val().replace(",", ".")).toFixed(2).replace(".", ",") + "</td>") + "<td class='penalty'>R$ " + parseFloat($("#txtValueMulta").val().replace(",", ".")).toFixed(2).replace(".", ",") + "</td>") + "<td class='discount'>R$ " + parseFloat($("#txtValueDescontos").val().replace(",", ".")).toFixed(2).replace(".", ",") + "</td>") + "<td class='rate'>R$ " + parseFloat($("#txtValueTaxas").val().replace(",", ".")).toFixed(2).replace(".", ",") + "</td>") + "<td class='register'>R$ " + parseFloat($("#txtValueCartorio").val().replace(",", ".")).toFixed(2).replace(".", ",") + "</td>") + "<td class='newRowValueExpense'>" + parseFloat($("#txtTotalValue").val().replace(",", ".")).toFixed(2).replace(".", ",") + "</td>", t = (t += "<td style='text-align:center;' class='newRow'><i class='fa fa-trash'/></td>") + "<td style='text-align:center;width:0px;' class='newRowHistoric'><input type='hidden' class='documentfile' value='" + e + "'/><input type='hidden' class='historicid' value='" + $("#Historic option:selected").val() + "' /><input type='hidden' class='historiccomplement' value='HISTÓRICO: " + $("#Historic option:selected").text() + " - " + $("#txtComplementDescription").val() + "'/><i class='fa fa-search'/></td>", t += "</tr>", $("#tblAllExpensers tbody").append(t); var o = 0; $(".newRowValueExpense").each(function () { var e = $(this).text().replace(",", ".").replace("R$", ""); o = parseFloat(o) + parseFloat(e) }), $("#spanTotalExpense").text(o.toFixed(2).replace(".", ",")), $(".newRowHistoric").click(function () { d($(this).find(".historiccomplement").val()) }), $(".newRow").click(function () { o = 0, $(this).closest("tr").remove(), $("#tblAllExpensers .newRowValueExpense").each(function () { var e = $(this).text().replace(",", ".").replace("R$", ""); o = parseFloat(o) + parseFloat(e) }), $("#spanTotalExpense").text("R$ " + o), m() }), x(), m(), $("#btnAddExpense").attr("disabled", "disabled"), $("#Companies").focus(), $("#Companies").select2("open") }), $("#documentFile").change(function () { var e = $(this).val(); "" != e && (i(), $("#spanNameDocument").html(e)) }), $("#btnLoadFile").click(function () { document.getElementById("documentFile").files[0]; i(document.getElementById("documentFile").files[0]) }), $(document).on("focus", ".select2.select2-container", function (e) { e.originalEvent && $(this).find(".select2-selection--single").length > 0 && $(this).siblings(".selectoption").select2("open") }), $("#Historic").change(function () { "0" !== $(this).val() && $.ajax({ type: "GET", url: "/Launch/GetHistoric/" + $(this).val(), dataType: "json", cache: !1, async: !0, success: function (e) { $("#txtComplement").val(e.complement) }, error: function (e, t, o) { console.log(o.message) } }) }), $("#btnSaveLot").click(function () { var e = $("#tblAllProtocols>tbody>tr").length; 1 == e && 1 == $("#tblAllProtocols>tbody>tr>td").length && (alert("1"), e = 0), confirm(`O lote ${$("#txtNumeroLote").val()} possui ${e} lançamento(s). Deseja continuar?`) && $.ajax({ type: "GET", url: "/Launch/CloseLot/" + $("#txtNumeroLote").val(), dataType: "json", cache: !1, async: !0, success: function (e) { 200 == e.code ? (d(`Lote ${$("#txtNumeroLote").val()} fechado com SUCESSO`), $("#txtNumeroLote").val(e.lotid), $("#txtNumeroProtocol").val(e.protocolid), $.ajax({ type: "GET", url: "/Launch/ProtocolsById/" + $("#txtNumeroLote").val(), dataType: "html", cache: !1, async: !0, success: function (e) { $("#divLot").html(e), $("#tblAllProtocols").DataTable({ pageLength: 3, bLengthChange: !1 }), p() } })) : 204 == e.code && u(e.message) } }) }), $("#btnSaveProtocol").click(function () { var t = "[", o = 0, a = parseFloat("0"), l = "["; $("#tblAllExpensers tbody tr").each(function () { var e = `{"AccountPlanId":${$(this).find(".expense").find("input[type='hidden']").val()}, \n                            "ProtocolId" :${$("#ProtocolId").val()}, \n                            "EstablishmentId":${parseInt($(this).find(".company").find("input[type='hidden']").val())}, \n                            "HistoricId":${$(this).find(".newRowHistoric").find(".historicid").val()}, \n                            "DocumentTypeId":${$(this).find(".documenttype").find("input[type='hidden']").val()}, \n                            "DocumentNumber":"${$(this).find(".documentnumber").text()}", \n                            "DocumentDate":"${$(this).find(".documentdate").text()}", \n                            "DocumentValue":${$(this).find(".documentvalue").text().replace("R$", "").replace(",", ".")}, \n                            "Interest":${$(this).find(".interest").text().replace("R$", "").replace(",", ".")}, \n                            "Penalty":${$(this).find(".penalty").text().replace("R$", "").replace(",", ".")}, \n                            "Discount": ${$(this).find(".discount").text().replace("R$", "").replace(",", ".")}, \n                            "Rate":${$(this).find(".rate").text().replace("R$", "").replace(",", ".")}, \n                            "Registry":${$(this).find(".register").text().replace("R$", "").replace(",", ".")},\n                            "DocumentPath":"${$(this).find(".newRowHistoric").find(".documentfile").val()}", \n                            "Complement":"${$(this).find(".newRowHistoric").find(".historiccomplement").val()}",\n                            "TotalValue":${$(this).find(".newRowValueExpense").text().replace("R$", "").replace(",", ".")}},`; l += e }), l = l.substring(0, l.lastIndexOf(",")), l += "]", $("#tblSource tbody tr").each(function () { var e = 0; $(this).find("td").each(function () { 0 == e ? o = $(this).text() : 2 == e ? a = $(this).text().replace("R$", "").replace(",", ".") : 3 == e && $(this).text(), e++ }); t = t + '{"AccountPlanId":' + o + ', "Value":' + a + ', "EstablishmentId": 0 },' }); t = (t = t.substring(0, t.lastIndexOf(","))) + "]"; var s = "{"; s = (s = (s = (s = (s = s + '"CompanyId":' + $("#CompanyId").val()) + ', "LoteId":' + $("#txtNumeroLote").val()) + ', "ProtocolId":' + $("#ProtocolId").val()) + ',"PayingSource":' + t) + ',"Expense":' + l, s += "}", console.log(s); try { $(".loader").css("display", "block"), $.ajax({ url: '@(Url.Action("InsertProtocol", "Launch"))', dataType: "json", type: "post", contentType: "application/json", data: s, processData: !1, success: function (t, o, a) { $(".loader").css("display", "none"), e(), p(), d(`Protocolo ${$("#txtNumeroProtocol").val()} incluído com SUCESSO!`), $("#txtNumeroProtocol").val(t.message) }, error: function (e, t, o) { $(".loader").css("display", "none"), console.log(o) } }) } catch (e) { console.log(e) } }), $("#btnAdd").click(function () { if ("" == $("#txtValue").val()) return u("Informe o valor da despesa"), $("#txtValue").focus(), void $("#txtValue").closest("td").css("border", "1px solid red"); if ("0" == $("#PayingSource option:selected").val()) return u("Selecione uma fonte pagadora"), $("#PayingSource").focus(), $("#PayingSource").select2("open"), void $("#PayingSource").closest("td").css("border", "1px solid red"); $("#txtValue").closest("td").css("border", "none"), $("#PayingSource").closest("td").css("border", "none"), $("#vlrTotal").closest("td").css("border", "none"); var e = "<tr>"; e = (e = (e = e + "<td>" + $("#PayingSource option:selected").val() + "</td>") + "<td>" + $("#PayingSource option:selected").text() + "</td>") + "<td class='newRowValue'>" + v($("#txtValue").val().replace(",", ".")) + "</td>", e += "<td style='text-align:center;' class='newRow'><i class='fa fa-trash'/></td>", e += "</tr>", $("#tblSource tbody").append(e); var t = 0; $(".newRowValue").each(function () { var e = $(this).text().replace(",", ".").replace("R$", ""); t = parseFloat(t) + parseFloat(e), $("#txtValue").val(""), $("#txtValue").focus() }), $("#vlrTotal").text(v(t)), $(".newRow").click(function () { t = 0, $(this).closest("tr").remove(), $("#tblSource .newRowValue").each(function () { var e = $(this).text().replace(",", ".").replace("R$", ""); t = parseFloat(t) + parseFloat(e) }), $("#vlrTotal").text(v(t)) }), m(), $("#PayingSource").val("0").change(), $("#txtValue").focus() }), $("#txtPartialValue").on("input", function () { if ("" != $("#txtPartialValue").val()) { n = parseFloat($("#txtPartialValue").val().replace(",", ".")); f() } }), $("#txtValueJuros").on("input", function () { if ("" != $("#txtValueJuros").val()) { if ("" == $("#txtPartialValue").val()) return $("#txtPartialValue").focus(), void u("Informe o subtotal deste documento"); t = parseFloat($("#txtValueJuros").val().replace(",", ".")), f() } }), $("#txtValueJuros").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#txtValueMulta").focus(), e.preventDefault(e), !1 }), $("#txtValueMulta").on("input", function () { if ("" != $("#txtValueMulta").val()) { if ("" == $("#txtPartialValue").val()) return $("#txtPartialValue").focus(), void u("Informe o subtotal deste documento"); o = parseFloat($("#txtValueMulta").val().replace(",", ".")), f() } }), $("#txtValueMulta").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#txtValueDescontos").focus(), e.preventDefault(e), !1 }), $("#txtValueDescontos").on("input", function () { if ("" != $("#txtValueDescontos").val()) { if ("" == $("#txtPartialValue").val()) return $("#txtPartialValue").focus(), void u("Informe o subtotal deste documento"); l = parseFloat($("#txtValueDescontos").val().replace(",", ".")), f() } }), $("#txtValueDescontos").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#txtValueTaxas").focus(), e.preventDefault(e), !1 }), $("#txtValueTaxas").on("input", function () { if ("" != $("#txtValueTaxas").val()) { if ("" == $("#txtPartialValue").val()) return $("#txtPartialValue").focus(), void u("Informe o subtotal deste documento"); a = parseFloat($("#txtValueTaxas").val().replace(",", ".")), f() } }), $("#txtValueTaxas").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#txtValueCartorio").focus(), e.preventDefault(e), !1 }), $("#txtValueCartorio").on("input", function () { if ("" != $("#txtValueCartorio").val()) { if ("" == $("#txtPartialValue").val()) return $("#txtPartialValue").focus(), void u("Informe o subtotal deste documento"); s = parseFloat($("#txtValueCartorio").val().replace(",", ".")), f() } }), $("#txtValueCartorio").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#btnAddExpense").focus(), e.preventDefault(e), !1 }), $("#Companies").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#Companies").focus(), e.preventDefault(e), !1 }), $("#txtValue").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#PayingSource").focus(), e.preventDefault(e), !1 }), $("#txtNumDocument").keypress(function (e) { 13 == (e.keyCode ? e.keyCode : e.which) && $("#txtPartialValue").focus() }), $("#txtPartialValue").keypress(function (e) { return 13 == (e.keyCode ? e.keyCode : e.which) && $("#txtValueJuros").focus(), e.preventDefault(e), !1 }), $("#txtComplementDescription").keypress(function (e) { 13 == (e.keyCode ? e.keyCode : e.which) && $("#txtDtDocument").focus() }), $("#txtValueExpense").keypress(function (e) { 13 == (e.keyCode ? e.keyCode : e.which) && $("#DocumentType").focus() }), $("#txtValueExpense").on("input", function () { "" != $("#txtValueCartorio").val() && "" != $("#txtPartialValue").val() && f() }) });