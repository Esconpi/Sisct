@model IEnumerable<Escon.SisctNET.Model.ProductNote>

@{
    ViewData["Title"] = "Relatory";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .table > thead > tr > th {
        border-bottom: 2px solid;
    }

    .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
        border: 1px solid;
    }
</style>

<div class="box box-primary" style="margin:-10px;">

    <div class="box-header">
        <div style="width:100%; overflow:hidden; padding:20px;">
            <div class="row">
                <div class="col-lg-12">
                    <img src="~/img/sisCT.png" style="width:25%; height:60%; float:left;" />
                    <img src="~/img/escon.png" style="width:20%; height:50%; float:right;" />
                </div>
            </div>

            <div style="text-align:center;">
                <strong>@ViewBag.Company.SocialName</strong> <br />
                <b>CNPJ: </b>@ViewBag.Company.Document <b>Insc. Estadual: </b> @ViewBag.Company.Ie
            </div>

            @await Html.PartialAsync("_ReportTypeName", new ViewDataDictionary(ViewData))

        </div>
        <div class="form-group col-lg-12 col-md-12 col-xs-12" style="text-align:right;">
            <strong>Periodo: @SessionManager.GetMonthInSession()/@SessionManager.GetYearInSession() </strong>
            <input type="hidden" value="@(@SessionManager.GetYearInSession())" id="periodYear" />
            <input type="hidden" value="@(@SessionManager.GetMonthInSession())" id="periodMonth" />
        </div>

    </div>


    <div class="box-body">

        <div style="width:100%;padding:2px;">

            @if (ViewBag.Erro == 1)
            {
                <p style="text-align:center;color:red;"><strong>OS DADOS PARA CALCULAR ICMS NÃO FORAM IMPORTADOS</strong></p>
            }
            else if (ViewBag.Erro == 2)
            {
                <p style="text-align:center;color:red;"><strong>OS DADOS PARA CALCULAR ANEXO CCCXVI NÃO FORAM IMPORTADOS</strong></p>
            }
            else if (ViewBag.Erro == 3)
            {
                <p style="text-align:center;color:red;"><strong>OS DADOS PARA CALCULAR ICMS PRODUTOR RURAL NÃO FORAM IMPORTADOS</strong></p>
            }
            else if (ViewBag.Erro == 4)
            {
                <p style="text-align:center;color:red;"><strong>HÁ PRODUTO NÃO TRIBUTADO</strong></p>
            }
            else if (ViewBag.Erro == 5)
            {
                <p style="text-align:center;color:red;"><strong>HÁ NOTA NÃO IMPORTADA</strong></p>
            }
            else
            {

                @if (ViewBag.Type == "Geral")
                {
                    <!-- Relatório Geral dos Impostos -->

                    @await Html.PartialAsync("_GeneralReport", new ViewDataDictionary(ViewData))
                }
                else if (ViewBag.Type == "GNRE" || ViewBag.Type == "IcmsST" || ViewBag.Type == "ProdutoFI" ||
                         ViewBag.Type == "ProdutoFP" || ViewBag.Type == "IcmsProdutor")
                {
                    <table class="table" style="font-size:8px; border: 2px solid;">
                        @if (ViewBag.Type == "GNRE")
                        {
                            <!-- Relatório GNRE -->

                            @await Html.PartialAsync("_GnreReport", new ViewDataDictionary(ViewData))
                        }
                        else if (ViewBag.Type == "IcmsST")
                        {
                            <!-- Relatório Produtos Substituição Tributária -->

                            @await Html.PartialAsync("_IcmsSt", new ViewDataDictionary(ViewData))
                        }
                        else if (ViewBag.Type == "ProdutoFI")
                        {
                            <!-- Relatório Produtos Fora do Incentivo -->

                            @await Html.PartialAsync("_ProductFIncentivoReport", new ViewDataDictionary(ViewData))
                        }
                        else if (ViewBag.Type == "ProdutoFP")
                        {
                            <!-- Relatório Produtos Fora da Pauta -->

                            @await Html.PartialAsync("_ProductFPautaReport", Model, new ViewDataDictionary(ViewData))
                        }
                        else if (ViewBag.Type == "IcmsProdutor")
                        {
                            <!-- Relatório ICMS Produtor Rural -->

                            @await Html.PartialAsync("_IcmsProducer", Model, new ViewDataDictionary(ViewData))
                        }
                    </table>
                }
                else
                {
                    @if (ViewBag.Type == "Produto" || ViewBag.Type == "ProdutoI" || ViewBag.Type == "ProdutoNI" || ViewBag.Type == "Nota" ||
                     ViewBag.Type == "AgrupadoA" || ViewBag.Type == "AgrupadoS")
                    {
                        <table class="table" style="font-size:8px; border: 2px solid;">

                            @if (ViewBag.Type == "Produto" || ViewBag.Type == "Nota" || ViewBag.Type == "ProdutoI" || ViewBag.Type == "ProdutoNI")
                            {
                                <!-- Produtos -->

                                @await Html.PartialAsync("_ProductReport", Model, new ViewDataDictionary(ViewData))
                            }
                            else if (ViewBag.Type == "AgrupadoA")
                            {
                                <!-- Produtos Agrupado -->

                                @await Html.PartialAsync("_ProductGroupedAnalyticalReport", Model, new ViewDataDictionary(ViewData))
                            }
                            else if (ViewBag.Type == "AgrupadoS")
                            {
                                <!-- Produtos Sintético -->

                                @await Html.PartialAsync("_ProductGroupedSyntheticReport", Model, new ViewDataDictionary(ViewData))
                            }

                        </table>

                        <!-- Resumo Produtos -->

                        @await Html.PartialAsync("_SummaryProducts", new ViewDataDictionary(ViewData))

                        if (ViewBag.TypeTaxation != "Isento" && ViewBag.TypeTaxation != "NT")
                        {
                            <!-- Resumo Imposto -->

                            @await Html.PartialAsync("_TaxSummary", new ViewDataDictionary(ViewData))
                        }
                    }

                    @if (ViewBag.Company.Incentive == true && (ViewBag.Company.AnnexId != null || ViewBag.Company.ChapterId == 4) && ViewBag.Type != "ProdutoNI" &&
                        ViewBag.TypeTaxation == "ST" && ViewBag.Type != "ProdutoFP")
                    {
                        <!-- Resumo Imposto Incentivo -->

                        @if (ViewBag.TypeTaxation == "ST" && ViewBag.Type != "ProdutoI")
                        {

                            @await Html.PartialAsync("_GeneralReportIncentive", new ViewDataDictionary(ViewData))
                            @await Html.PartialAsync("_GeneralSummaryTaxIncentive", new ViewDataDictionary(ViewData))

                        }
                        else if (ViewBag.TypeTaxation == "ST")
                        {
                            @await Html.PartialAsync("_IncentiveTaxSummary", new ViewDataDictionary(ViewData))
                        }

                    }
                }
            }


        </div>

    </div>

    @if (ViewBag.Erro != 1 && ViewBag.Erro != 2 && ViewBag.Erro != 4 && ViewBag.Type == "Geral")
    {
        <div class="box-footer no-print">
            <div class="barcode" style="font-size:15px;">
                10540558000113
            </div>
            <div class="pull-left">
                <i class="fa fa-warning"></i>
                <span id="responseMessageGenerateBillet" style="font-style:italic;color:red;">Ao clicar no botão ao lado o documento DAR será gerado e o boleto enviado para o cliente.</span>
            </div>

            @await Html.PartialAsync("_ButtonGenerateBillet", new ViewDataDictionary(ViewData))

        </div>

    }

</div>

@if (ViewBag.Erro != 1 && ViewBag.Erro != 2 && ViewBag.Erro != 4 && ViewBag.Type == "Geral")
{
    <br />
    <br />
    <div class="box box-warning no-print" style="margin:-10px;">
        <div class="box-header">
            <div class="box-title">
                <i class="fa fa-list"></i>
                DAR Gerados
            </div>
        </div>
        <div class="box-body">
            <div class="row">
                <div class="col-md-12">
                    <div id="responseBarCodeGenerateBillet" style="padding:15px;">

                    </div>
                </div>
            </div>
        </div>
    </div>
}
